version: "3.8"

services:
  samba:
    image: dperson/samba
    container_name: samba
    restart: always
    command: |
      {% for user in SAMBA -%}
      -u "{{ user.USER }};{{ user.PASS }}"
      -s "{{ user.USER }};/{{ user.USER }};yes;no"
      {% endfor -%}
      -s "media;/media;yes;no"
      -s "torrents;/torrents;yes;no"
      -s "backup;/backup;yes;no"
    stdin_open: true
    tty: true
    environment:
      - TZ={{ TIMEZONE }}
    ports:
      - 139:139
      - 445:445
    volumes:
      - {{ STORAGE }}/shared/media:/media
      - {{ STORAGE }}/shared/torrents:/torrents
      - {{ DRIVES[1]['MOUNT'] }}:/backup
      {% for user in SAMBA -%}
      - {{ STORAGE }}/files/{{ user.USER }}:/files/{{ user.USER }}
      {% endfor %}

  plex:
    image: jaymoulin/plex:latest
    container_name: plex
    hostname: plex
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - VERSION=docker
      - TZ={{ TIMEZONE }}
    volumes:
      - {{ STORAGE }}/docker/Plex Media Server:/root/Library/Application Support/Plex Media Server
      - {{ STORAGE }}/shared/media:/shared/media

  transmission:
    image: lscr.io/linuxserver/transmission:latest
    container_name: transmission
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
      - UMASK_SET=022
    volumes:
      - {{ STORAGE }}/docker/transmission:/config
      - {{ STORAGE }}/shared/torrents:/shared/torrents
    ports:
      - 9091:9091
      - 51413:51413
      - 51413:51413/udp
    restart: unless-stopped
    
  overseerr:
    image: lscr.io/linuxserver/overseerr:latest
    container_name: overseerr
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
    volumes:
      - {{ STORAGE }}/docker/overseerr:/config
    ports:
      - 5055:5055
    restart: unless-stopped

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
      - UMASK_SET=022
    volumes:
      - {{ STORAGE }}/docker/radarr:/config
      - {{ STORAGE }}/shared:/shared
    ports:
      - 7878:7878
    restart: unless-stopped

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
      - UMASK_SET=022
    volumes:
      - {{ STORAGE }}/docker/sonarr:/config
      - {{ STORAGE }}/shared:/shared
    ports:
      - 8989:8989
    restart: unless-stopped

  bazarr:
    image: lscr.io/linuxserver/bazarr:latest
    container_name: bazarr
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
      - UMASK_SET=022
    volumes:
      - {{ STORAGE }}/docker/bazarr:/config
      - {{ STORAGE }}/shared:/shared
    ports:
      - 6767:6767
    restart: unless-stopped

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
    volumes:
      - {{ STORAGE }}/docker/prowlarr:/config
    ports:
      - 9696:9696
    restart: unless-stopped

  flaresolverr:
    image: ghcr.io/flaresolverr/flaresolverr:latest
    container_name: flaresolverr
    environment:
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - LOG_HTML=${LOG_HTML:-false}
      - CAPTCHA_SOLVER=${CAPTCHA_SOLVER:-none}
      - TZ={{ TIMEZONE }}
    ports:
      - "${PORT:-8191}:8191"
    restart: unless-stopped 

  duplicati:
    image: lscr.io/linuxserver/duplicati:latest
    container_name: duplicati
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - TZ={{ TIMEZONE }}
      - UMASK=022
    volumes:
      - {{ STORAGE }}/docker/duplicati:/config
      - {{ BACKUP }}/duplicati:/backups
      - {{ STORAGE }}/docker:/data/docker
      - {{ STORAGE }}/files:/data/files
    ports:
      - 8200:8200
    restart: unless-stopped