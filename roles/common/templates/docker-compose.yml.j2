version: "3.7"

services:
  samba:
    image: dperson/samba
    restart: always
    command: |
      {% for user in SAMBA -%}
      -u "{{ user.USER }};{{ user.PASS }}"
      -s "{{ user.USER }};/{{ user.USER }};yes;no"
      {% endfor -%}
      -s "Media;/Media;yes;no"
      -s "Downloads;/Downloads;yes;no"
      -s "TimeMachine;/TimeMachine;yes;no"
    stdin_open: true
    tty: true
    environment:
      - TZ={{ TIMEZONE }}
    ports:
      - 139:139
      - 445:445
    volumes:
      - {{ STORAGE }}/Media:/Media
      - {{ STORAGE }}/Media/Downloads:/Downloads
      - {{ DRIVES[1]['MOUNT'] }}:/TimeMachine
      {% for user in SAMBA -%}
      - {{ STORAGE }}/files/{{ user.USER }}:/files/{{ user.USER }}
      {% endfor %}

  plex:
    image: jaymoulin/plex:latest 
    hostname: plex
    restart: unless-stopped
    network_mode: host
    environment:
      - PUID={{ PUID }}
      - PGID={{ PGID }}
      - VERSION=docker
      - TZ={{ TIMEZONE }}
    volumes:
      - {{ STORAGE }}/Plex Media Server:/root/Library/Application Support/Plex Media Server
      - {{ STORAGE }}/Media:/media

{#  transmission: #}
{#    image : jaymoulin/transmission:3.00-1.6.1 #}
{#    command: transmission-daemon -f -g /config #}
{#    volumes: #}
{#      - ./transmission:/config #}
{#      - {{ STORAGE }}/torrents:/Downloads #}
{#    ports: #}
{#      - 9091:9091 #}
{#      - 51413:51413 #}
{#      - 51413:51413/udp #}
{#    expose: #}
{#      - 9091 #}
{#    restart: unless-stopped #}

{#  flexget: #}
{#    image: wiserain/flexget:3.5 #}
{#    volumes: #}
{#      - ./flexget:/config #}
{#      - ./flexget/custom-cont-init.d:/custom-cont-init.d #}
{#      - {{ STORAGE }}/torrents:/Downloads #}
{#      - {{ STORAGE }}/Media:/storage #}
{#      - {{ STORAGE }}/Media/Movies:/Media/Movies #}
{#      - {{ STORAGE }}/Media/Series:/Media/Series #}
{#    ports: #}
{#      - 5050:5050 #}
{#    environment: #}
{#      - PUID=1001 #}
{#      - PGID=1001 #}
{#      - TORRENT_PLUGIN=transmission #}
{#      - FG_WEBUI_PASSWD={{ TRANSMISSION_PASS }} #}
{#    restart: unless-stopped #}
{#    links: #}
{#      - transmission #}

  {# networks: #}
  {#   lan: #}
  {#     driver: macvlan #}
  {#     driver_opts: #}
  {#       parent: eth0 #}
  {#     ipam: #}
  {#       config: #}
  {#         - subnet: "192.168.0.0/24" #}
  {#         - gateway: "192.168.0.1" #}